<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Poker - Lobby</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body class="lobby-page">
    <div class="lobby-container">
        <header>
            <h1>‚ô†Ô∏è Poker Lobby ‚ô•Ô∏è</h1>
            <div class="user-info">
                <span id="username-display"></span>
                <button id="logout-btn" class="btn btn-small">Logout</button>
            </div>
        </header>

        <div id="error-message" class="error-message" style="display: none;"></div>

        <div class="tables-section">
            <h2>Available Tables</h2>
            <button id="refresh-tables-btn" class="btn btn-secondary">üîÑ Refresh</button>

            <div id="tables-list" class="tables-list">
                <div class="loading">Loading tables...</div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Check if logged in
        const serverUrl = sessionStorage.getItem('serverUrl');
        const accessToken = sessionStorage.getItem('accessToken');
        const username = sessionStorage.getItem('username');

        if (!serverUrl || !accessToken) {
            window.location.href = 'index.html';
        }

        document.getElementById('username-display').textContent = `Logged in as: ${username}`;

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            sessionStorage.clear();
            window.location.href = 'index.html';
        });

        // Load tables
        async function loadTables() {
            try {
                const tables = await fetchTables();
                displayTables(tables);
            } catch (error) {
                showError('Failed to load tables: ' + error.message);
            }
        }

        function displayTables(tables) {
            const tablesList = document.getElementById('tables-list');

            if (tables.length === 0) {
                tablesList.innerHTML = '<div class="no-tables">No tables available</div>';
                return;
            }

            tablesList.innerHTML = tables.map(table => `
                <div class="table-card">
                    <div class="table-header">
                        <h3>${table.name}</h3>
                        ${table.is_private ? '<span class="badge">üîí Private</span>' : ''}
                    </div>
                    <div class="table-info">
                        <div class="info-row">
                            <span>Players:</span>
                            <span>${table.player_count}/${table.max_players}</span>
                        </div>
                        <div class="info-row">
                            <span>Blinds:</span>
                            <span>${table.small_blind}/${table.big_blind}</span>
                        </div>
                    </div>
                    <button class="btn btn-primary join-table-btn" data-table-id="${table.id}">
                        Join Table
                    </button>
                </div>
            `).join('');

            // Add click handlers
            document.querySelectorAll('.join-table-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tableId = e.target.dataset.tableId;
                    joinTable(tableId);
                });
            });
        }

        function joinTable(tableId) {
            sessionStorage.setItem('tableId', tableId);
            window.location.href = 'game.html';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Refresh button
        document.getElementById('refresh-tables-btn').addEventListener('click', loadTables);

        // Load tables on page load
        loadTables();

        // Auto-refresh every 5 seconds
        setInterval(loadTables, 5000);
    </script>
</body>
</html>
